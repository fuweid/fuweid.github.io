<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.124.1"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>fuweid</title>
<meta name=keywords content="Blog,Linux,Container,Kubernetes"><meta name=description content><meta name=author content><link rel=canonical href=https://fuweid.com/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><link rel=icon href=https://fuweid.com/favicon.jpg><link rel=icon type=image/png sizes=16x16 href=https://fuweid.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fuweid.com/favicon-32x32.png><link rel=apple-touch-icon href=https://fuweid.com/apple-touch-icon.png><link rel=mask-icon href=https://fuweid.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://fuweid.com/index.xml><link rel=alternate type=application/json href=https://fuweid.com/index.json><link rel=alternate hreflang=en href=https://fuweid.com/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-1C7VLVHN52"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1C7VLVHN52",{anonymize_ip:!1})}</script><meta property="og:title" content="fuweid"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://fuweid.com/"><meta property="og:site_name" content="fuweid"><meta name=twitter:card content="summary"><meta name=twitter:title content="fuweid"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"fuweid","url":"https://fuweid.com/","description":"","thumbnailUrl":"https://fuweid.com/favicon.jpg","sameAs":["https://twitter.com/fuweid89","https://github.com/fuweid"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fuweid.com/ accesskey=h title="fuweid.com (Alt + H)">fuweid.com</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>Hi there ğŸ‘‹</h1></header><div class=entry-content></div><footer class=entry-footer><div class=social-icons><a href=https://twitter.com/fuweid89 target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a><a href=https://github.com/fuweid target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2>è„é¡µå¤§å° - 18446744073709551614 ?!</h2></header><div class=entry-content><p>åˆ†äº«ä¸€ä¸ª etcd-io/etcd@17615 é—®é¢˜ï¼šç”¨æˆ·å‘ç° etcd è¿›ç¨‹å†™å…¥ WAL æ—¥å¿—æœ‰æŠ–åŠ¨ï¼Œä½†æ˜¯ç£ç›˜å‹åŠ›å¹¶ä¸å¤§ï¼Œè€Œä¸” fsync ç³»ç»Ÿè°ƒç”¨éƒ½å¾ˆæ­£å¸¸ï¼› åæ¥é€šè¿‡ Tracing å·¥å…·å®šä½åˆ°äº†å†…æ ¸ memory-cgroup è„é¡µæ•°æ®ç»Ÿè®¡æœ‰é—®é¢˜ï¼Œä¸è¿‡è¯¥é—®é¢˜ä»…ä¼šå‡ºç°åœ¨ v5.15.0-63 å°ç‰ˆæœ¬ã€‚ 17615 é—®é¢˜å•é‡Œæœ‰è¯¦å°½çš„å®šä½è¿‡ç¨‹ï¼Œæ¨èçœ‹çœ‹ã€‚ å› ä¸ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç¿»é˜…äº†ç›¸å…³çš„å†…æ ¸ PATCH é‚®ä»¶ï¼Œåšäº†ä»¥ä¸‹çš„è„é¡µåˆ†é…é™æµ (ç®€å•) æ€»ç»“ã€‚
è„é¡µåˆ†é…é™æµ - balance_dirty_pages å›å†™ (Writeback) æ˜¯æŒ‡å†…æ ¸è´Ÿè´£å°†è„é¡µ (DirtyPage) åˆ·å…¥å­˜å‚¨è®¾å¤‡ä¸Šï¼Œå®ƒæ¶‰åŠåˆ°è„é¡µåˆ†é…æ§åˆ¶ã€‚
åœ¨ v4.2 ç‰ˆæœ¬ä¹‹å‰ï¼Œè„é¡µåˆ†é…æ›´å¤šæ˜¯ç”± memory-cgroup æ¥æ§åˆ¶ï¼›è€Œè„é¡µæµæ§æ ¸å¿ƒ - balance_dirty_pages - æ ¹æ®å…¨å±€çš„è„é¡µæ°´ä½æƒ…å†µæ¥å†³å®šæ˜¯å¦éœ€è¦æ§é€Ÿã€‚ åœ¨ LinuxCon Japan 2015 ä¼šè®®ä¸Šï¼Œå†…æ ¸å¼€å‘è€… Tejun Heo è®¤ä¸ºï¼Œåœ¨æ²¡æœ‰æ„ŸçŸ¥åˆ°å…¨å±€è„é¡µæ°´ä½çš„æƒ…å†µï¼Œmemory-cgroup æ— æ³•å¯¹è„é¡µè¿›è¡Œæœ‰æ•ˆçš„æ§åˆ¶ã€‚ æ ¸å¿ƒ balance_dirty_pages å‡½æ•°é€šè¿‡ vm.dirty[_background]_{ratio, bytes} å‚æ•°æ¥è®¡ç®—å…¨å±€è„é¡µçš„æ°´ä½ä¸Šé™ã€‚ Tejun Heo è®¤ä¸ºæ™®é€šçš„ memory-cgroup ä¹Ÿåº”é‡‡ç”¨åŒæ ·çš„æ–¹å¼æ¥è®¡ç®—ç»„å†…çš„è„é¡µæ°´ä½ä¸Šé™ï¼Œè€Œæ ¹ç»„ memory-cgroup åªä¸è¿‡æ˜¯é€€åŒ–åˆ°å…¨å±€æ¨¡å¼ï¼Œå½“ç„¶å…¨å±€è„é¡µçš„æ°´ä½ä¼˜å…ˆçº§æ›´é«˜ã€‚
NOTE: balance_dirty_pages_ratelimited ä¼šè°ƒç”¨ balance_dirty_pagesã€‚
åœ¨ writeback: cgroup writeback support PATCH åˆå¹¶åˆ° v4....</p></div><footer class=entry-footer>&lt;span title='2024-04-11 20:48:45 +0800 HKT'>April 11, 2024&lt;/span></footer><a class=entry-link aria-label="post link to è„é¡µå¤§å° - 18446744073709551614 ?!" href=https://fuweid.com/post/2024-dirtypage--2/></a></article><article class=post-entry><header class=entry-header><h2>åŒæ­¥è¿‘æœŸ containerd çš„é«˜é¢‘é—®é¢˜</h2></header><div class=entry-content><p>æœ€è¿‘ Issue 8698 æœ‰ç”¨æˆ·è¯´å®¹å™¨å¯åŠ¨å’Œæ¸…ç†éƒ½åæ…¢ï¼Œå°¤å…¶å¤šä¸ª Pod åŒæ—¶å¯åŠ¨æ—¶ç°è±¡ç‰¹åˆ«æ˜æ˜¾ã€‚ä¹‹å‰æœ‰è¿‡ç±»ä¼¼çš„é—®é¢˜: containerd å¯åŠ¨å®¹å™¨å‰ï¼Œå®ƒéœ€è¦ä¸´æ—¶æŒ‚è½½ rootfs æ¥è¯»å– uid/gid ä¿¡æ¯ã€‚å› ä¸ºæŒ‚è½½çš„æ˜¯å¯å†™å±æ€§çš„ overlayfsï¼Œå¸è½½æ—¶å†…æ ¸ä¼šå¼ºåˆ¶åˆ·ç›˜ã€‚å½“ç³»ç»Ÿå¤§é‡çš„è„é¡µæ•°æ®éœ€è¦å›å†™æ—¶ï¼Œè¿™ä¸ªåˆ·ç›˜åŠ¨ä½œå®¹æ˜“é€ æˆç³»ç»Ÿå¡é¡¿ã€‚ oci: use readonly mount to read user/group info å·²ç»è§£å†³è¯»å– uid/gid çš„æ€§èƒ½é—®é¢˜äº†ï¼Œä½†è¿™ä¸€æ¬¡æ˜¯ Pod Init-container å¸¦æ¥çš„ ã€‚
Init-container rootfs å¤§éƒ¨åˆ†éƒ½æ˜¯å¯å†™æ¨¡å¼çš„ overlayfsï¼Œå¦‚æœ Init-container æ˜¯åšæ•°æ®é¢„ä¸‹è½½çš„è¯ï¼Œé‚£ä¹ˆ containerd åœ¨åˆ é™¤ Init-container æ—¶ï¼Œå†…æ ¸ä¸€å®šä¼šåˆ·ç›˜ã€‚åœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼ŒåŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ Pod å…±äº«åŒä¸€å—æ•°æ®ç›˜ï¼Œè¿™ç§ä¸é¢„æœŸçš„åˆ·ç›˜å¾ˆå®¹æ˜“æŠŠç³»ç»Ÿæ‰“å´©ã€‚è¿˜æœ‰ Issue 8647 ç”¨æˆ·è¯´ï¼Œä»–çš„ç³»ç»Ÿä¸€å¼€å§‹è¿˜å¥½å¥½çš„ï¼Œè·‘å‡ å¤©å°±ä¸ç¨³å®šäº†ã€‚åæ¥æŸ¥çœ‹ä»–æä¾›çš„æ—¥å¿—ï¼Œå‘ç°æœ‰å‡ ä¸ª Pod ä¸€ç›´å¯åŠ¨å¤±è´¥ï¼Œç›¸å½“äºæ¯éš”å‡ ç§’éƒ½è¦å»åˆ·ç›˜ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸ç¨³å®šã€‚
è¿™ä¸ªé—®é¢˜çš„æœ€ä½³è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯åšå¥½ Pod çš„å­˜å‚¨éš”ç¦»ï¼Œä½†æ˜¾ç„¶è¿™æˆæœ¬ç¡®è¦é«˜ä¸å°‘ã€‚ç„¶è€Œ Kubernetes åœºæ™¯ä¸‹çš„å®¹å™¨å¹¶ä¸ä¼šé‡å¯ï¼Œå³ä½¿åœ¨ã€Œå¤±è´¥åæ— é™é‡å¯ã€çš„ç­–ç•¥ä¸‹ï¼Œkubelet ä¾ç„¶æ˜¯åˆ é™¤é‡å»ºï¼Œè¿™ä¹Ÿæ„å‘³ç€å®¹å™¨ rootfs å¹¶ä¸éœ€è¦æŒä¹…åŒ–ã€‚ä¸ªäººè§‰å¾—ï¼Œæˆæœ¬æœ€ä½çš„è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯ä½¿ç”¨ overlayfs-volatile-mountï¼Œå®ƒéœ€è¦ Linux Kernel â‰¥ 5.10ã€‚ä»¥ä¸‹æ˜¯ä¸ªäººç›®å‰äº†è§£åˆ°çš„æƒ…å†µï¼Œå¤§éƒ¨åˆ†äº‘å‚å®¶éƒ½æ”¯æŒäº† overlayfs-volatileã€‚
Azure Ubuntu 22.04 LTS - Kernel 5.15 (GA) AWS Kubernetes â‰¥ 1....</p></div><footer class=entry-footer>&lt;span title='2023-08-13 23:48:45 +0800 HKT'>August 13, 2023&lt;/span></footer><a class=entry-link aria-label="post link to åŒæ­¥è¿‘æœŸ containerd çš„é«˜é¢‘é—®é¢˜" href=https://fuweid.com/post/2023-08-sync-containerd-issue/></a></article><article class=post-entry><header class=entry-header><h2>containerd 1.7: åƒåœ¾å›æ”¶çš„æ‹“å±•</h2></header><div class=entry-content><p>ä¹‹å‰å’Œè‹¦æ€»/Ace ç»´æŠ¤ pouch-container/containerd çš„æ—¶å€™ï¼Œæˆ‘ä»¬é‡åˆ°æ¯”è¾ƒå¤šçš„é—®é¢˜æ˜¯èµ„æºæ³„æ¼ï¼Œæ¯”å¦‚èŠ‚ç‚¹è´Ÿè½½å¤ªé«˜ä»¥è‡³äºæ— æ³• umount å®¹å™¨æ ¹ç›®å½•(å®¹å™¨ bundle ç›®å½•æ®‹ç•™ï¼‰ï¼Œå†…æ ¸ pidns æ­»é”é—®é¢˜å¯¼è‡´å®¹å™¨è¿›ç¨‹åƒµå°¸æ€( cgroup æ®‹ç•™)ï¼Œè¿˜æœ‰è¿›ç¨‹é‡å¯å¯¼è‡´ CNI ç½‘ç»œèµ„æºæ³„æ¼ç­‰ç­‰ã€‚å¯¹äºå†…æ ¸æ­»é”ç­‰é—®é¢˜ï¼Œé‡å¯å¯èƒ½æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆï¼›è€Œé‚£äº›å› ä¸ºçŸ­æœŸé«˜è´Ÿè½½æˆ–è€…è¿›ç¨‹é‡å¯å¯¼è‡´çš„èµ„æºæ³„æ¼ï¼Œå®ƒä»¬éœ€è¦ä»ç³»ç»Ÿå±‚é¢è§£å†³ï¼Œè‡³å°‘åº”è¯¥è®©èµ„æºçš„åˆ›å»ºè€…æœ‰æœºä¼šå»æ¸…ç†ã€‚
containerd å®ƒæœ¬èº«å°±å…·å¤‡åƒåœ¾å›æ”¶èƒ½åŠ›ï¼Œä½†å®ƒåªå…³æ³¨å†…éƒ¨èµ„æºçš„æ¸…ç†ï¼Œæ¯”å¦‚é•œåƒæ•°æ®ä»¥åŠå®¹å™¨å¯å†™å±‚ã€‚è€Œ CNI ç½‘ç»œèµ„æºä»¥åŠ containerd-shim ç­‰å¤–éƒ¨èµ„æºå¹¶ä¸åœ¨åƒåœ¾å›æ”¶çš„ç®¡ç†èŒƒå›´å†…ï¼Œè¿™éƒ¨åˆ†èµ„æºå®¹æ˜“å‡ºç°æ³„æ¼çš„æƒ…å†µï¼Œæ¯”å¦‚ GKE å¹³å°çš„ç”¨æˆ·å°±å¤šæ¬¡é‡åˆ°äº† Containerd IP leakage : ç›´åˆ° pause å®¹å™¨åˆ›å»ºä¹‹å‰ï¼Œcontainerd ä»…åœ¨å†…å­˜é‡Œä¿æŒå¯¹ç½‘ç»œèµ„æºçš„å¼•ç”¨ï¼›åœ¨å°†ç½‘ç»œèµ„æºç»‘å®šç»™ pod ä»¥å‰ï¼Œcontainerd ä¸€æ—¦è¢«å¼ºåˆ¶é‡å¯å°±ä¼šå‘ç”Ÿæ³„æ¼ã€‚å½“æ—¶ containerd ç¤¾åŒºçš„å¤„ç†æ–¹å¼æ˜¯æå‰åˆ›å»º pod è®°å½•ï¼Œä»¥æ­¤æ¥æå‰å…³è”ç½‘ç»œèµ„æºï¼Œå¹¶åˆ©ç”¨ kubelet çš„åƒåœ¾å›æ”¶æœºåˆ¶æ¥è§¦å‘èµ„æºæ¸…ç†ã€‚é—®é¢˜å€’æ˜¯è§£å†³äº†ï¼Œä½†è¯¥æ–¹æ¡ˆä»…é€‚ç”¨äº kubernetes åœºæ™¯ï¼Œæœ€åˆç†çš„æ–¹æ¡ˆåº”è¯¥æ˜¯åˆ›å»ºè€…åº”å…·å¤‡å‘¨æœŸæ€§çš„æ¸…ç†æµç¨‹ã€‚
è€ƒè™‘æˆ‘ä»¬è¿˜æœ‰ shim èµ„æºæ³„æ¼çš„é—®é¢˜ï¼Œcontainerd ç¤¾åŒºæäº† Add collectible resources to metadata gc æ–¹æ¡ˆæ¥ç®¡ç†å¤–éƒ¨èµ„æºæ¸…ç†ã€‚åœ¨ä»‹ç»è¿™ä¸ªæ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆä»‹ç»ä¸‹ containerd çš„åƒåœ¾æ¸…ç†æœºåˆ¶ã€‚
åŸºäºæ ‡ç­¾ç³»ç»Ÿå’Œ lease æ„å»ºçš„åƒåœ¾å›æ”¶ containerd æ ¸å¿ƒæ’ä»¶ metadata ç®¡ç†ç€å®¹å™¨å’Œé•œåƒæ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­è™šçº¿æ–¹å—ä»£è¡¨ç€å­æ¨¡å—ï¼Œæ¯”å¦‚ Images ä»£è¡¨ç€ image serviceï¼Œå®ƒä»…ç”¨æ¥ç®¡ç†é•œåƒåå­—å’Œé•œåƒ manifest çš„æ˜ å°„å…³ç³»ï¼Œè€Œé•œåƒçš„ blob æ•°æ®å’Œè§£å‹åçš„æ–‡ä»¶å†…å®¹åˆ†åˆ«ç”± content service å’Œ snapshot service ç®¡ç†ï¼›éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œcontainer service ä»…ç”¨æ¥ä¿å­˜ç”¨äºå¯åŠ¨å®¹å™¨çš„é…ç½®ä¿¡æ¯ï¼Œå®ƒå¹¶ä¸è´Ÿè´£ç®¡ç†å®¹å™¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚...</p></div><footer class=entry-footer>&lt;span title='2023-03-19 19:48:45 +0800 HKT'>March 19, 2023&lt;/span></footer><a class=entry-link aria-label="post link to containerd 1.7: åƒåœ¾å›æ”¶çš„æ‹“å±•" href=https://fuweid.com/post/2023-containerd-17-gc/></a></article><article class=post-entry><header class=entry-header><h2>containerd 1.7: Image Transfer Service</h2></header><div class=entry-content><p>ä» HELM Chart æˆåŠŸå¯¹æ¥å®¹å™¨é•œåƒä»“åº“å¼€å§‹ï¼Œåˆ°è¿‘ä¸¤å¹´ OCI ç¤¾åŒº artifacts æ ‡å‡†åŒ–çš„è½åœ°æ¨å¹¿ï¼Œç°åœ¨ OCI Registry as Storage å·²ç»æ˜¯äº‹å®æ ‡å‡†ï¼Œä¸åŒä¸šåŠ¡åœºæ™¯çš„æ•°æ®å­˜å‚¨éƒ½å¯ä»¥å¯¹æ¥ OCI registry çš„åˆ†å‘åè®®ã€‚åŒæ—¶ï¼Œè¿™å‡ å¹´å®¹å™¨é•œåƒçš„å®‰å…¨ä¾›åº”é“¾éœ€æ±‚å¾’å¢ï¼Œä»¥åŠå„å¤§äº‘å‚å•†å¯¹å®¹å™¨é•œåƒ lazy-loading æ¢ç´¢åŠ›åº¦åœ¨åŠ å¤§ï¼ŒOCI ç¤¾åŒºåœ¨ artifacts æ ‡å‡†çš„åŸºç¡€ä¸Šä¸ºå®¹å™¨é•œåƒå¼•å…¥ referrers å®šä¹‰ï¼šåœ¨ä¿è¯å‰åå…¼å®¹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªå®¹å™¨é•œåƒéƒ½å¯ä»¥é€šè¿‡å…³è”çš„ artifacts æ¥æ‹“å±•è‡ªèº«çš„å±æ€§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ referrers å…³è”ç‰¹æ€§ä¸º net-monitor:v1 é•œåƒæä¾›äº†é•œåƒç­¾åå’Œ SBOM ä¿¡æ¯ã€‚å½“ç„¶ï¼Œå®¹å™¨é•œåƒ lazy-loading å±æ€§ä¹Ÿå¯ä»¥ä¸ä¹‹ç›¸å…³è”ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„ overlaybdï¼Œèš‚èšé‡‘æœçš„ nydus ä»¥åŠäºšé©¬é€Šçš„ sociã€‚
NOTE: å›¾ç‰‡å–è‡ª Feynman Zhou å‘è¡¨çš„ Azure Container Registry: the first cloud registry to support the OCI Specifications 1.1 æ–‡ç« ã€‚
å¯é¢„è§çš„æ˜¯ï¼Œå„å¤§äº‘å‚å•†çš„é•œåƒä»“åº“éƒ½ä¼šè·Ÿè¿›è¿™ä¸€æ ‡å‡†ï¼Œå®‰å…¨ä¾›åº”é“¾ä»¥åŠå®¹å™¨é•œåƒåŠ é€Ÿçš„å¢å€¼æœåŠ¡ä¹Ÿä¼šå› æ­¤å¾—åˆ°å¤§é¢ç§¯æ¨å¹¿ã€‚è€Œä½œä¸ºå®¹å™¨é•œåƒçš„æ¶ˆè´¹ç«¯ï¼Œä¸ºäº†æ”¯æŒè¿™ä¸€ç‰¹æ€§ï¼Œcontainerd ç¤¾åŒºçš„æƒ³æ³•æ˜¯å¼•å…¥ç»„åˆå‹æ’ä»¶ Image Transfer Serviceï¼Œå°†é•œåƒåˆ†å‘å’Œæ‰“åŒ…å¤„ç†éƒ½æŠ½è±¡æˆæ•°æ®æµçš„è½¬å‘ï¼Œå¹¶ç»Ÿä¸€æ”¶ç¼–åœ¨æœåŠ¡ç«¯å¤„ç†ã€‚
Pull éœ€è¦æ–°çš„æŠ½è±¡ åœ¨ containerd 1.7 ç‰ˆæœ¬ä¹‹å‰ï¼Œé•œåƒæ•°æ®å¤„ç†çš„ç»å¤§éƒ¨åˆ†æ“ä½œéƒ½é›†ä¸­åœ¨å®¢æˆ·ç«¯ã€‚containerd è®¾è®¡åå‘äºæŠŠæœåŠ¡ç«¯åšè–„ï¼ŒæœåŠ¡ç«¯ä»…åšåº•å±‚èµ„æºçš„ CRUDï¼›è€Œå®¢æˆ·ç«¯åˆ™é‡‡ç”¨ç±»ä¼¼ Backends For Frontend ç†å¿µæ¥ä¸ºå¤æ‚æµç¨‹å°è£…æ¥å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º Pull é•œåƒçš„å‡½æ•°æ¥å£ã€‚ä¸‹è½½é•œåƒæ¶‰åŠåˆ°é•œåƒåœ°å€è§£æã€å¯†é’¥ç®¡ç†ã€å¹¶å‘ä¸‹è½½ä»¥åŠè§£å‹å¤„ç†ï¼Œä½†è¯¥æµç¨‹ä»…é€‚ç”¨äºä¸‹è½½æ ‡å‡†æ ¼å¼çš„é•œåƒï¼Œä»»ä½•è°ƒæ•´éƒ½å®¹æ˜“äº§ç”Ÿä¸é€‚ã€‚...</p></div><footer class=entry-footer>&lt;span title='2023-03-13 01:20:45 +0800 HKT'>March 13, 2023&lt;/span></footer><a class=entry-link aria-label="post link to containerd 1.7: Image Transfer Service" href=https://fuweid.com/post/2023-containerd-17-transfer-service/></a></article><article class=post-entry><header class=entry-header><h2>containerd 1.7: UserNamespace Stateless Pod</h2></header><div class=entry-content><p>containerd 1.7 ç‰ˆæœ¬æœ‰æ¯”è¾ƒå¤šçš„å®éªŒç‰¹æ€§ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šä»‹ç» containerd å¯¹ UserNamespace Stateless Pod æ”¯æŒçš„æƒ…å†µï¼Œç®—æ˜¯ä¸ªäººå¯¹ containerd 1.7 ç‰ˆæœ¬ç‰¹æ€§ä»‹ç»ç³»åˆ—çš„å¼€ç¯‡ã€‚
1. UserNamespace å®‰å…¨ç‰¹æ€§ Linux å†…æ ¸æ˜¯åŸºäºè¿›ç¨‹çš„ credentials(7) å‡­è¯æ¥åšè®¿é—®æ§åˆ¶ï¼Œæ¯”å¦‚è¿›ç¨‹çš„æ‹¥æœ‰è€…æ ‡è¯† UID/GID å’Œç”¨äºç³»ç»Ÿèµ„æºè®¿é—®æ§åˆ¶åˆ¤å®šçš„ Effective UID/GID ç­‰å‡­è¯ã€‚è€Œ user_namespace(7) æä¾›äº†å®‰å…¨éš”ç¦»ç‰¹æ€§ã€‚åœ¨ä¸åŒçš„ user namespace(userns) ä¸‹ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸ä»…æœ‰ä¸åŒçš„ UID/GIDï¼ŒåŒæ—¶è¿˜å…·å¤‡äº†ä¸åŒçš„ capabilities(7) æƒé™ã€‚æ¯”å¦‚ u1001 ç”¨æˆ·è¿›ç¨‹ bash é€šè¿‡ unshare -r bash è¿›å…¥åˆ°äº†æ–°çš„ usernsï¼Œå¹¶å°†è‡ªå·±æ˜ å°„æˆäº† root ç”¨æˆ·ï¼Œè¿˜å…·å¤‡äº†æ‰€æœ‰çš„ capabilitiesã€‚ä½†è¿™ä¸ªè¿›ç¨‹çœŸçš„å°±å˜æˆäº†ç‰¹æƒè¿›ç¨‹ï¼Ÿè¿™å–å†³äºè¯¥ç”¨æˆ·åœ¨ç³»ç»Ÿèµ„æºæ‰€å±çš„ userns é‡Œæ˜¯å¦æ‹¥æœ‰è®¿é—®æƒé™ã€‚
åœ¨ä»‹ç»å…·ä½“çš„åˆ¤å®šè§„åˆ™å‰ï¼Œå…ˆèŠ±ç‚¹æ—¶é—´äº†è§£ä¸‹å†…æ ¸æ˜¯å¦‚ä½•ç®¡ç† UID/GID çš„æ˜ å°„å…³ç³»ã€‚
æ¯ä¸ªè¿›ç¨‹éƒ½å¿…é¡»å½’å±äºæŸä¸€ä¸ª usernsã€‚åœ¨åˆå§‹çŠ¶æ€ä¸‹ï¼Œè¿›ç¨‹éƒ½å±äº initial usernsã€‚Initial userns æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ²¡æœ‰ä»»ä½•æ˜ å°„å…³ç³»ï¼›Linux æ”¯æŒåµŒå¥—çš„ usernsï¼Œæ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„ userns ç»„æˆçš„å…³ç³»å›¾å°†ä¼šæ˜¯ä»¥ initial userns ä¸ºæ ¹çš„æ ‘çŠ¶å›¾ã€‚åœ¨ parent userns é‡Œçš„è¿›ç¨‹ï¼Œåªè¦å…·å¤‡ CAP_SET{UID,GID} èƒ½åŠ›ï¼Œè¿™äº›è¿›ç¨‹å°±å¯ä»¥é€šè¿‡ /proc/[pid]/{uid,gid}_map æ–‡ä»¶æ¥å£ï¼Œä»¥ ID-inside-ns ID-outside-ns Range-length çš„æ ¼å¼ï¼Œç»™åˆšè¿›å…¥ child userns çš„è¿›ç¨‹è®¾ç½® UID/GID æ˜ å°„å…³ç³»ï¼Œè€Œåˆ›å»ºè¯¥ userns è¿›ç¨‹çš„ Effective UID(EUID) å°†æˆä¸º userns çš„æ‰€æœ‰è€…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚...</p></div><footer class=entry-footer>&lt;span title='2023-03-04 15:20:45 +0800 HKT'>March 4, 2023&lt;/span></footer><a class=entry-link aria-label="post link to containerd 1.7: UserNamespace Stateless Pod" href=https://fuweid.com/post/2023-containerd-17-userns/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://fuweid.com/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=https://fuweid.com/>fuweid</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>